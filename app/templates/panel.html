{% extends "navbar.html" %}
{% block title %} Painel Principal {% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-5">
        <div class="col-12">
            <div class="hero-card bg-gradient-primary text-white rounded-4 shadow-lg">
                <div class="card-body p-5">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex align-items-center mb-3">
                                <div class="avatar-circle me-3">
                                    <i class="bi bi-person-circle fs-1"></i>
                                </div>
                                <div>
                                    <h2 class="mb-1 fw-bold">Bem-vindo de volta!</h2>
                                    <h4 class="mb-0 opacity-90">{{ current_user.name }}</h4>
                                </div>
                            </div>
                            <p class="lead mb-0 opacity-75">Acesse suas ferramentas e gerencie suas atividades com facilidade</p>
                        </div>
                        <div class="col-md-4 text-end d-none d-md-block">
                            <div class="stats-widget">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="stat-item">
                                            <h3 class="fw-bold mb-0">{{ notice|length }}</h3>
                                            <small class="opacity-75">Avisos</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-item">
                                            <h3 class="fw-bold mb-0">4</h3>
                                            <small class="opacity-75">Módulos</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include 'partials/_flash_messages.html' %}
    
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold text-dark mb-0">
                    <i class="bi bi-grid-3x3-gap-fill text-primary me-2"></i>
                    Módulos do Sistema
                </h3>
                <span class="badge bg-light text-dark px-3 py-2">4 módulos disponíveis</span>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <!-- NIR -->
        <div class="col-lg-4 col-md-6">
            <div class="feature-card h-100 position-relative overflow-hidden">
                <div class="card-body p-4">
                    <div class="feature-header mb-3">
                        <div class="feature-icon bg-danger bg-opacity-10 rounded-3 p-3 mb-3 d-inline-flex">
                            <i class="bi bi-hospital text-danger fs-3"></i>
                        </div>
                        <h5 class="fw-bold mb-2">NIR - Internações</h5>
                        <p class="text-muted mb-3">Registre e acompanhe as notificações de internação.</p>
                    </div>
                    <div class="feature-actions">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('nir.new_record') }}" 
                               class="btn btn-danger d-flex align-items-center justify-content-center">
                                <i class="bi bi-journal-plus me-2"></i>
                                Novo Registro
                            </a>
                            <a href="{{ url_for('nir.list_records') }}" 
                               class="btn btn-outline-danger d-flex align-items-center justify-content-center">
                                <i class="bi bi-clipboard-data me-2"></i>
                                Ver Registros
                            </a>
                        </div>
                    </div>
                </div>
                <div class="feature-decoration position-absolute top-0 end-0 opacity-10">
                    <i class="bi bi-hospital" style="font-size: 8rem;"></i>
                </div>
            </div>
        </div>

        <!-- Repositório de Arquivos -->
        <div class="col-lg-4 col-md-6">
            <div class="feature-card h-100 position-relative overflow-hidden">
                <div class="card-body p-4">
                    <div class="feature-header mb-3">
                        <div class="feature-icon bg-primary bg-opacity-10 rounded-3 p-3 mb-3 d-inline-flex">
                            <i class="bi bi-archive text-primary fs-3"></i>
                        </div>
                        <h5 class="fw-bold mb-2">Repositório de Arquivos</h5>
                        <p class="text-muted mb-3">Gerencie documentos e arquivos importantes com segurança e organização</p>
                    </div>
                    <div class="feature-actions">
                        <a href="{{ url_for('repository.repository_list_page') }}" 
                           class="btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center">
                            <i class="bi bi-archive me-2"></i>
                            Acessar Repositório
                        </a>
                    </div>
                </div>
                <div class="feature-decoration position-absolute top-0 end-0 opacity-10">
                    <i class="bi bi-archive" style="font-size: 8rem;"></i>
                </div>
            </div>
        </div>

        <!-- Passagem de Plantão -->
        <div class="col-lg-4 col-md-6">
            <div class="feature-card h-100 position-relative overflow-hidden">
                <div class="card-body p-4">
                    <div class="feature-header mb-3">
                        <div class="feature-icon bg-success bg-opacity-10 rounded-3 p-3 mb-3 d-inline-flex">
                            <i class="bi bi-arrow-left-right text-success fs-3"></i>
                        </div>
                        <h5 class="fw-bold mb-2">Passagem de Plantão</h5>
                        <p class="text-muted mb-3">Registre e acompanhe as passagens de plantão e relatórios de turno</p>
                    </div>
                    <div class="feature-actions">
                        <div class="d-grid gap-2">
                            {% if current_user.has_permission('gerar_relatorios') %}
                            <a href="{{ url_for('form.new_form') }}" 
                               class="btn btn-success d-flex align-items-center justify-content-center">
                                <i class="bi bi-journal-plus me-2"></i>
                                Novo Registro
                            </a>
                            {% endif %}
                            <a href="{{ url_for('form.forms') }}" 
                               class="btn btn-outline-success d-flex align-items-center justify-content-center">
                                <i class="bi bi-clipboard-data me-2"></i>
                                Ver Registros
                            </a>
                        </div>
                    </div>
                </div>
                <div class="feature-decoration position-absolute top-0 end-0 opacity-10">
                    <i class="bi bi-arrow-left-right" style="font-size: 8rem;"></i>
                </div>
            </div>
        </div>

        <!-- Treinamentos -->
        <div class="col-lg-4 col-md-6">
            <div class="feature-card h-100 position-relative overflow-hidden">
                <div class="card-body p-4">
                    <div class="feature-header mb-3">
                        <div class="feature-icon bg-warning bg-opacity-10 rounded-3 p-3 mb-3 d-inline-flex">
                            <i class="bi bi-mortarboard-fill text-warning fs-3"></i>
                        </div>
                        <h5 class="fw-bold mb-2">Treinamentos</h5>
                        <p class="text-muted mb-3">Acesse cursos e materiais de treinamento para desenvolvimento profissional</p>
                    </div>
                    <div class="feature-actions">
                        <a href="{{ url_for('training.course_list_page') }}" 
                           class="btn btn-warning btn-lg w-100 d-flex align-items-center justify-content-center">
                            <i class="bi bi-mortarboard-fill me-2"></i>
                            Acessar Cursos
                        </a>
                    </div>
                </div>
                <div class="feature-decoration position-absolute top-0 end-0 opacity-10">
                    <i class="bi bi-mortarboard-fill" style="font-size: 8rem;"></i>
                </div>
            </div>
        </div>
    </div>
    <!-- Notices -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold text-dark mb-0">
                    <i class="bi bi-megaphone-fill text-info me-2"></i>
                    Mural de Avisos
                </h3>
                {% if notice %}
                <span class="badge bg-info text-white px-3 py-2">{{ notice|length }} avisos</span>
                {% endif %}
            </div>
            
            {% if notice %}
            <div class="notices-container">
                {% for n in notice %}
                <div class="notice-card mb-4">
                    {% if n.notice_type == 'IMAGE' and n.image_filename %}
                    <div class="notice-header">
                        <div class="notice-meta">
                            <span class="notice-date">
                                <i class="bi bi-calendar3 me-1"></i>
                                {{ n.date_registry | format_date_time }}
                            </span>
                        </div>
                    </div>
                    <div class="notice-content text-center">
                        <div class="notice-image-container">
                            <a href="#" class="d-block position-relative" data-bs-toggle="modal"
                                data-bs-target="#imageNoticeModal"
                                data-img-src="{{ url_for('admin.notices.serve_notice_image', filename=n.image_filename) }}">
                                <img src="{{ url_for('admin.notices.serve_notice_image', filename=n.image_filename) }}"
                                    class="img-fluid rounded-3 shadow-sm notice-image" alt="Aviso em imagem">
                                <div class="image-overlay">
                                    <i class="bi bi-arrows-fullscreen text-white fs-2"></i>
                                    <p class="text-white mt-2 mb-0">Clique para ampliar</p>
                                </div>
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <div class="notice-header">
                        <h5 class="notice-title">{{ n.title }}</h5>
                        <div class="notice-meta">
                            <span class="notice-date">
                                <i class="bi bi-calendar3 me-1"></i>
                                {{ n.date_registry | format_date_time }}
                            </span>
                        </div>
                    </div>
                    <div class="notice-content">
                        <div class="notice-text">{{ n.content | safe }}</div>
                    </div>
                    {% endif %}
                    
                    <div class="notice-footer">
                        <div class="author-info">
                            <i class="bi bi-person-circle me-2"></i>
                            <span>Publicado por <strong>{{ n.author.name }}</strong></span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state text-center py-5">
                <div class="empty-icon mb-3">
                    <i class="bi bi-megaphone text-muted" style="font-size: 4rem;"></i>
                </div>
                <h5 class="text-muted mb-2">Nenhum aviso no momento</h5>
                <p class="text-muted">Os avisos importantes aparecerão aqui quando forem publicados.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
<div class="modal fade" id="imageNoticeModal" tabindex="-1" aria-labelledby="imageNoticeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-transparent border-0">
            <div class="modal-body p-0 position-relative text-center">
                <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3 p-2"
                    style="z-index: 10; background-color: rgba(0,0,0,0.5); border-radius: 50%;" data-bs-dismiss="modal"
                    aria-label="Fechar"></button>

                <img id="modalNoticeImage" src="" class="img-fluid rounded" alt="Imagem do Aviso"
                    style="max-height: 90vh; object-fit: contain;">
            </div>
        </div>
    </div>
</div>
{% if popup_aviso %}
<div class="modal fade" id="avisoModal" tabindex="-1" aria-labelledby="avisoModalLabel" aria-hidden="true">
    {% if popup_aviso.notice_type == 'IMAGE' and popup_aviso.image_filename %}
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-transparent border-0">
            <div class="modal-body p-0 position-relative text-center">

                <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3 p-2"
                    style="z-index: 10; background-color: rgba(0,0,0,0.5); border-radius: 50%;" data-bs-dismiss="modal"
                    aria-label="Fechar"></button>

                <img src="{{ url_for('admin.notices.serve_notice_image', filename=popup_aviso.image_filename) }}"
                    class="img-fluid rounded" alt="Imagem do Aviso" style="max-height: 90vh; object-fit: contain;">
            </div>
        </div>
    </div>
    {% else %}
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow-lg border-0 border-top border-primary border-5" style="border-radius: 0.5rem;">
            <div class="modal-body p-4 p-lg-5">
                <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"
                    aria-label="Fechar"></button>
                <div class="text-center">
                    <i class="bi bi-megaphone-fill display-4 text-primary mb-3"></i>
                    <h4 class="modal-title mb-3" id="avisoModalLabel">{{ popup_aviso.title }}</h4>
                    <p class="text-secondary" style="white-space: pre-wrap;">{{ popup_aviso.content | safe }}</p>
                </div>
                <hr class="my-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="small text-muted"><strong class="d-block">Publicado por:</strong><span>{{
                            popup_aviso.author.name }}</span></div>
                    <div class="small text-muted text-end"><strong class="d-block">Data:</strong><span>{{
                            popup_aviso.date_registry | format_date_time }}</span></div>
                </div>
                <div class="d-grid mt-4">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Entendido</button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const featureCards = document.querySelectorAll('.feature-card');
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, index * 100);
                }
            });
        }, observerOptions);

        featureCards.forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(card);
        });
    });
    document.addEventListener('DOMContentLoaded', function () {
        var avisoModalElement = document.getElementById('avisoModal');
        if (avisoModalElement) {
            var avisoModal = new bootstrap.Modal(avisoModalElement);
            avisoModal.show();
        }

        const imageNoticeModal = document.getElementById('imageNoticeModal');
        if (imageNoticeModal) {
            const modalImage = document.getElementById('modalNoticeImage');

            imageNoticeModal.addEventListener('show.bs.modal', function (event) {
                const triggerLink = event.relatedTarget;
                const imageUrl = triggerLink.getAttribute('data-img-src');
                modalImage.src = imageUrl;
            });
        }
    });

    
</script>
{% endblock %}